# æ—…æ¸¸å®¢æœAI - è‡ªåŠ¨çŸ¥è¯†åº“æ„å»ºå·¥å…·

> **ä»»åŠ¡**: T7 - è‡ªåŠ¨çŸ¥è¯†åº“æ„å»ºå·¥å…·  
> **äº¤ä»˜ç‰©**: `docs/auto-kb-builder.md` + `src/kb_builder/`  
> **è´Ÿè´£äºº**: æç†  
> **æ—¥æœŸ**: 2026-02-19

---

## ä¸€ã€é—®é¢˜èƒŒæ™¯

### 1.1 ç°çŠ¶ç—›ç‚¹

å¤§å¤šæ•°æ—…æ¸¸å…¬å¸æ²¡æœ‰ç°æˆçš„ç»“æ„åŒ–çŸ¥è¯†åº“ï¼Œä½†æœ‰ä¸°å¯Œçš„åŸå§‹æ•°æ®ï¼š
- ğŸ“„ äº§å“æ–‡æ¡£ (PDF/Word/ç½‘é¡µ)
- ğŸ“Š å†å²è®¢å• (Excel/æ•°æ®åº“)
- ğŸ’¬ èŠå¤©è®°å½• (å®¢æœå¯¹è¯/å¾®ä¿¡ç¾¤)

**ä¼ ç»Ÿæ–¹æ¡ˆ**: äººå·¥æ•´ç† â†’ è€—æ—¶æ•°å‘¨ â†’ æˆæœ¬é«˜æ˜‚  
**ç›®æ ‡æ–¹æ¡ˆ**: è‡ªåŠ¨æå– â†’ å‡ å°æ—¶ â†’ å¯è¿è¡Œ

---

## äºŒã€ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åŸå§‹æ•°æ®è¾“å…¥å±‚                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ äº§å“æ–‡æ¡£   â”‚  â”‚ å†å²è®¢å•   â”‚  â”‚ èŠå¤©è®°å½•   â”‚            â”‚
â”‚  â”‚ PDF/DOCX   â”‚  â”‚ CSV/XLSX   â”‚  â”‚ JSON/TXT   â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚               â”‚               â”‚
         â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®é¢„å¤„ç†å±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ æ–‡æ¡£è§£æ   â”‚  â”‚ æ•°æ®æ¸…æ´—   â”‚  â”‚ å¯¹è¯åˆ†å‰²   â”‚            â”‚
â”‚  â”‚ â€¢ PDFæå–  â”‚  â”‚ â€¢ å»é‡     â”‚  â”‚ â€¢ æŒ‰ä¼šè¯åˆ‡ â”‚            â”‚
â”‚  â”‚ â€¢ è¡¨æ ¼è¯†åˆ« â”‚  â”‚ â€¢ è„±æ•     â”‚  â”‚ â€¢ è§’è‰²æ ‡è®° â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚               â”‚               â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    çŸ¥è¯†æå–å±‚ (LLMé©±åŠ¨)                      â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              äº§å“ä¿¡æ¯æŠ½å–å™¨                          â”‚   â”‚
â”‚  â”‚  è¾“å…¥: äº§å“æ–‡æ¡£æ–‡æœ¬                                  â”‚   â”‚
â”‚  â”‚  è¾“å‡º: {åç§°,ä»·æ ¼,è¡Œç¨‹,æ”¿ç­–,äº®ç‚¹}                   â”‚   â”‚
â”‚  â”‚  Prompt: "ä»ä»¥ä¸‹æ–‡æ¡£æå–äº§å“ä¿¡æ¯..."               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              è®¢å•æ¨¡å¼åˆ†æå™¨                          â”‚   â”‚
â”‚  â”‚  è¾“å…¥: å†å²è®¢å•æ•°æ®                                  â”‚   â”‚
â”‚  â”‚  è¾“å‡º: {çƒ­é”€äº§å“,å¸¸è§é—®é¢˜,é€€æ”¹åŸå› }                 â”‚   â”‚
â”‚  â”‚  æ–¹æ³•: èšç±» + ç»Ÿè®¡åˆ†æ                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              å¯¹è¯QAæå–å™¨                            â”‚   â”‚
â”‚  â”‚  è¾“å…¥: å®¢æœèŠå¤©è®°å½•                                  â”‚   â”‚
â”‚  â”‚  è¾“å‡º: [{é—®é¢˜,ç­”æ¡ˆ,é¢‘æ¬¡}]                           â”‚   â”‚
â”‚  â”‚  Prompt: "æ‰¾å‡ºå¯¹è¯ä¸­çš„é—®ç­”å¯¹..."                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    çŸ¥è¯†èåˆå±‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ å®ä½“å¯¹é½   â”‚  â”‚ ç›¸ä¼¼åº¦èšç±» â”‚  â”‚ è´¨é‡è¯„åˆ†   â”‚            â”‚
â”‚  â”‚ â€¢ äº§å“å   â”‚  â”‚ â€¢ MinHash  â”‚  â”‚ â€¢ å®Œæ•´æ€§   â”‚            â”‚
â”‚  â”‚ â€¢ ç›®çš„åœ°   â”‚  â”‚ â€¢ è¯­ä¹‰ç›¸ä¼¼ â”‚  â”‚ â€¢ ä¸€è‡´æ€§   â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚               â”‚               â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å®¡æ ¸ä¸è¾“å‡ºå±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ å¾…å®¡æ ¸é˜Ÿåˆ— â”‚  â”‚ äººå·¥ç¡®è®¤   â”‚  â”‚ çŸ¥è¯†åº“ç”Ÿæˆ â”‚            â”‚
â”‚  â”‚ (ä½ç½®ä¿¡åº¦) â”‚â—„â”€â”¤ (å¯é€‰)     â”œâ”€â”€â–ºâ”‚ (JSON/MD)  â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸‰ã€æ ¸å¿ƒæ¨¡å—è®¾è®¡

### 3.1 äº§å“æ–‡æ¡£æŠ½å–å™¨

```python
class ProductExtractor:
    """ä»æ–‡æ¡£æå–äº§å“ä¿¡æ¯"""
    
    def extract(self, doc_text: str) -> Product:
        prompt = f"""
        ä»ä»¥ä¸‹æ—…æ¸¸äº§å“æ–‡æ¡£ä¸­æå–ç»“æ„åŒ–ä¿¡æ¯:
        
        æ–‡æ¡£å†…å®¹:
        {doc_text[:3000]}
        
        è¯·æå–ä»¥ä¸‹å­—æ®µ(JSONæ ¼å¼):
        - name: äº§å“åç§°
        - price: ä»·æ ¼ (æ•°å­—)
        - duration: å¤©æ•°
        - destination: ç›®çš„åœ° (åˆ—è¡¨)
        - highlights: äº®ç‚¹ (åˆ—è¡¨)
        - inclusions: åŒ…å«é¡¹ç›® (åˆ—è¡¨)
        - exclusions: ä¸åŒ…å«é¡¹ç›® (åˆ—è¡¨)
        - visa_info: ç­¾è¯ä¿¡æ¯
        - cancellation_policy: é€€æ”¹æ”¿ç­–
        
        å¦‚æœæŸä¸ªå­—æ®µæ‰¾ä¸åˆ°ï¼Œå¡«nullã€‚
        """
        
        response = llm.generate(prompt)
        return json.loads(response)
```

### 3.2 è®¢å•æ¨¡å¼åˆ†æå™¨

```python
class OrderAnalyzer:
    """åˆ†æå†å²è®¢å•æ•°æ®"""
    
    def analyze(self, orders: List[Order]) -> Insights:
        # 1. çƒ­é”€äº§å“ç»Ÿè®¡
        hot_products = Counter(o.product_name for o in orders).most_common(10)
        
        # 2. é€€æ”¹åŸå› èšç±»
        refund_reasons = [o.refund_reason for o in orders if o.refund_reason]
        clusters = self.cluster_texts(refund_reasons)
        
        # 3. å¸¸è§é—®é¢˜æ¨æ–­
        faq_candidates = self.infer_faq_from_orders(orders)
        
        return Insights(
            hot_products=hot_products,
            common_issues=clusters,
            faq_candidates=faq_candidates
        )
```

### 3.3 å¯¹è¯QAæå–å™¨

```python
class ConversationAnalyzer:
    """ä»èŠå¤©è®°å½•æå–QAå¯¹"""
    
    def extract_qa_pairs(self, conversations: List[Conversation]) -> List[QA]:
        qa_pairs = []
        
        for conv in conversations:
            # æŒ‰ä¼šè¯åˆ†ç»„
            messages = conv.messages
            
            # è¯†åˆ«é—®ç­”å¯¹
            for i, msg in enumerate(messages):
                if msg.role == "customer":
                    question = msg.content
                    # æ‰¾åç»­å®¢æœå›å¤
                    for j in range(i+1, min(i+3, len(messages))):
                        if messages[j].role == "agent":
                            answer = messages[j].content
                            qa_pairs.append(QA(
                                question=question,
                                answer=answer,
                                confidence=self.score_qa_quality(question, answer)
                            ))
                            break
        
        # æŒ‰ç½®ä¿¡åº¦è¿‡æ»¤
        return [qa for qa in qa_pairs if qa.confidence > 0.7]
```

---

## å››ã€æ•°æ®æ ¼å¼

### 4.1 è¾“å…¥æ ¼å¼

**äº§å“æ–‡æ¡£**: æ”¯æŒ PDF, DOCX, HTML, å›¾ç‰‡(OCR)

**å†å²è®¢å•** (CSV):
```csv
order_id,product_name,price,customer_id,status,refund_reason,created_at
ORD001,å·´å˜å²›7æ—¥æ¸¸,8999,C001,completed,,2026-01-15
ORD002,ä¸œäº¬5æ—¥æ¸¸,12999,C002,refunded,è¡Œç¨‹å˜æ›´,2026-01-20
```

**èŠå¤©è®°å½•** (JSON):
```json
{
  "session_id": "SESS001",
  "messages": [
    {"role": "customer", "content": "å·´å˜å²›å¤šå°‘é’±ï¼Ÿ", "timestamp": "..."},
    {"role": "agent", "content": "å·´å˜å²›7æ—¥æ¸¸8999å…ƒ", "timestamp": "..."}
  ]
}
```

### 4.2 è¾“å‡ºæ ¼å¼

**ç”Ÿæˆçš„çŸ¥è¯†åº“**:
```json
{
  "products": [...],
  "faqs": [...],
  "policies": [...],
  "metadata": {
    "generated_at": "2026-02-19T10:00:00Z",
    "sources": ["products.pdf", "orders.csv", "chats.json"],
    "confidence_summary": {...}
  }
}
```

---

## äº”ã€è´¨é‡è¯„ä¼°

### 5.1 è¯„åˆ†ç»´åº¦

| ç»´åº¦ | æƒé‡ | è¯„ä¼°æ–¹æ³• |
|-----|------|---------|
| å®Œæ•´æ€§ | 30% | å¿…å¡«å­—æ®µç¼ºå¤±ç‡ |
| ä¸€è‡´æ€§ | 25% | è·¨æ–‡æ¡£ä¿¡æ¯å†²çªæ£€æµ‹ |
| å‡†ç¡®æ€§ | 25% | æŠ½æ ·äººå·¥éªŒè¯ |
| è¦†ç›–ç‡ | 20% | é«˜é¢‘é—®é¢˜è¦†ç›–æ¯”ä¾‹ |

### 5.2 ç½®ä¿¡åº¦é˜ˆå€¼

- **é«˜ç½®ä¿¡åº¦ (â‰¥0.85)**: è‡ªåŠ¨å…¥åº“
- **ä¸­ç½®ä¿¡åº¦ (0.6-0.85)**: å¾…å®¡æ ¸é˜Ÿåˆ—
- **ä½ç½®ä¿¡åº¦ (<0.6)**: ä¸¢å¼ƒæˆ–äººå·¥å¤„ç†

---

## å…­ã€ä½¿ç”¨æµç¨‹

```bash
# 1. å‡†å¤‡æ•°æ®
data/
â”œâ”€â”€ products/
â”‚   â”œâ”€â”€ å·´å˜å²›.pdf
â”‚   â””â”€â”€ ä¸œäº¬.docx
â”œâ”€â”€ orders/
â”‚   â””â”€â”€ 2025_orders.csv
â””â”€â”€ chats/
    â””â”€â”€ wechat_export.json

# 2. è¿è¡Œæ„å»ºå·¥å…·
python -m kb_builder.build \
  --products-dir ./data/products \
  --orders-file ./data/orders/2025_orders.csv \
  --chats-file ./data/chats/wechat_export.json \
  --output ./knowledge_base.json

# 3. å®¡æ ¸ä½ç½®ä¿¡åº¦é¡¹ç›® (å¯é€‰)
python -m kb_builder.review --input ./knowledge_base.json

# 4. å¯¼å…¥å®¢æœç³»ç»Ÿ
curl -X POST http://localhost:8000/api/kb/import \
  -F "file=@knowledge_base.json"
```

---

## ä¸ƒã€äº¤ä»˜æ¸…å•

- [x] ç³»ç»Ÿæ¶æ„è®¾è®¡
- [x] æ ¸å¿ƒæ¨¡å—è®¾è®¡ (æŠ½å–å™¨/åˆ†æå™¨/æå–å™¨)
- [x] æ•°æ®æ ¼å¼å®šä¹‰
- [x] è´¨é‡è¯„ä¼°æ ‡å‡†
- [x] ä½¿ç”¨æµç¨‹è¯´æ˜

**å®ç°ä»£ç **: `src/kb_builder/` (å¾…å¼€å‘)
